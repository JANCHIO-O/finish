<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>用户管理</title>
</head>
<body>
<h2>用户信息查询</h2>

<p th:if="${message}" th:text="${message}"></p>

<table border="1">
    <thead>
    <tr>
        <th>账号</th>
        <th>角色</th>
        <th>姓名</th>
        <th>性别</th>
        <th>手机号</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="info : ${readerInfos}">
        <td th:text="${info.cardNo}"></td>
        <td th:text="${info.role}"></td>
        <td th:text="${info.name}"></td>
        <td th:text="${info.gender}"></td>
        <td th:text="${info.mobile}"></td>
    </tr>
    </tbody>
</table>

<h3>账号删除</h3>
<form th:action="@{/user/manage}" method="get">
    <label>
        账号类型：
        <select name="role" required>
            <option value="">请选择</option>
            <option value="TEACHER" th:selected="${selectedRole == 'TEACHER'}">教师账号</option>
            <option value="STUDENT" th:selected="${selectedRole == 'STUDENT'}">学生账号</option>
        </select>
    </label>
    <button type="submit">筛选</button>
</form>
<form th:action="@{/user/manage/delete}" method="post">
    <input type="hidden" name="role" th:value="${selectedRole}">
    <label>
        对应账号：
        <select name="accountId" th:disabled="${selectedRole == null || selectedRole.isBlank()}" required>
            <option value="">请选择账号</option>
            <option th:each="account : ${filteredAccounts}"
                    th:value="${account.accountId}"
                    th:text="${readerNameMap[account.accountId] != null ? account.accountId + ' - ' + readerNameMap[account.accountId] : account.accountId}">
            </option>
        </select>
    </label>
    <button type="submit" th:disabled="${selectedRole == null || selectedRole.isBlank()}">删除账号</button>
</form>
<p th:if="${selectedRole != null && selectedRole != '' && (filteredAccounts == null || filteredAccounts.isEmpty())}">
    当前类型下暂无可删除账号。
</p>

<h3>账号删除记录</h3>
<a th:href="@{/user/manage/delete-records}">查看账号删除记录</a>

<p>
    <a th:href="@{/user/manage/logout}">退出登录</a>
</p>
<a th:href="@{/user}">返回用户管理目录</a>
</body>
</html>
